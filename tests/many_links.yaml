version: "3.3"
services:
  bootstrapper:
    image: warpenguin.no-ip.org/privilegedbootstrapper:1.3
    command: ["netsim", "python3 /opt/NEED/emucore.py"]
    deploy:
      mode: global
      placement:
        constraints:
          - node.labels.gigabit == true
    volumes:
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
    networks:
      - NEEDnet

  dashboard:
    image: warpenguin.no-ip.org/dashboard:4.5
    ports:
      - "8088:8088"
    hostname: dashboard
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet
      - outside

  client1:
    image: warpenguin.no-ip.org/client:8.3
    command: ['server1']
    hostname: client1
    labels:
      netsim: "true"
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet

  server1:
    image: warpenguin.no-ip.org/server:8.3
    hostname: server1
    labels:
      netsim: "true"
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet

  client2:
    image: warpenguin.no-ip.org/client:8.3
    command: ['server2']
    hostname: client2
    labels:
      netsim: "true"
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet

  server2:
    image: warpenguin.no-ip.org/server:8.3
    hostname: server2
    labels:
      netsim: "true"
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet

  client3:
    image: warpenguin.no-ip.org/client:8.3
    command: ['server3']
    hostname: client3
    labels:
      netsim: "true"
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet

  server3:
    image: warpenguin.no-ip.org/server:8.3
    hostname: server3
    labels:
      netsim: "true"
    deploy:
      replicas: 20
      placement:
        constraints:
          - node.labels.gigabit == true
    configs:
      - source: topology
        target: /topology.xml
        uid: '0'
        gid: '0'
        mode: 0555
    networks:
      - NEEDnet

configs:
  topology:
    file: topology_many_links.xml

networks:
  NEEDnet:
    external:
      name: test1
  outside:
    driver: overlay

