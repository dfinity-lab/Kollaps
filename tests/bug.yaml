version: "3.3"
services:
  bootstrapper:
    image: warpenguin.no-ip.org/privilegedbootstrapper:1.3
    command: ["netsim", "python3 /opt/TCAL/prot.py"]
    deploy:
      mode: global
      placement:
        constraints:
          - node.labels.gigabit == true
    volumes:
      - type: bind
        source: /var/run/docker.sock
        target: /var/run/docker.sock
    networks:
      - NEEDnet

  service:
    image: warpenguin.no-ip.org/bug:1.2
    hostname: service
    labels:
      netsim: "true"
    deploy:
      replicas: 120
      placement:
        constraints:
          - node.labels.gigabit == true
    networks:
      - NEEDnet

networks:
  NEEDnet:
    external:
      name: test1
  outside:
    driver: overlay

